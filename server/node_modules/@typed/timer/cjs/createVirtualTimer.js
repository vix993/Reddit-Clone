"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createVirtualTimer = void 0;
const createVirtualClock_1 = require("./createVirtualClock");
const Timeline_1 = require("./Timeline");
/**
 * Create a VirtualTimer. Useful for testing.
 * @param startingTime (optional) :: number
 */
function createVirtualTimer(clock = createVirtualClock_1.createVirtualClock()) {
    const timeline = new Timeline_1.Timeline();
    function delay(f, delayMS) {
        const time = clock.currentTime() + delayMS;
        timeline.addTask(time, f);
        return { dispose: () => timeline.removeTask(time, f) };
    }
    function runTasks() {
        const currentTime = clock.currentTime();
        const tasks = timeline.readyTasks(currentTime);
        tasks.forEach((task) => task(currentTime));
    }
    return {
        ...clock,
        delay,
        progressTimeBy: (delay) => {
            clock.progressTimeBy(delay);
            runTasks();
        },
    };
}
exports.createVirtualTimer = createVirtualTimer;
//# sourceMappingURL=createVirtualTimer.js.map